# Crucible Reverse Proxy Configuration
# Copyright (c) Altare Technologies Limited

# Global server configuration
server:
  # HTTP port (default: 80)
  http_port: 80

  # HTTPS port (default: 443)
  https_port: 443

  # Number of worker threads (default: CPU count)
  # workers: 4

  # Connection timeout in seconds (default: 30)
  timeout: 30

  # Maximum concurrent connections per backend (default: 1024)
  max_connections_per_backend: 1024

  # Altare Flux Security System Configuration
  security:
    # Enable security features (default: true)
    enabled: true

    # Block Tor exit nodes (default: true)
    block_tor: true

    # Block known bot/proxy IPs (default: true)
    block_bots: true

    # Rate limiting configuration
    rate_limit:
      # Default requests per second per IP (default: 20)
      default_rps: 20

      # API requests per second per IP (higher limit for /api/* routes) (default: 100)
      api_rps: 100

      # Time window in seconds (default: 1)
      window_seconds: 1

    # Request size limits
    request_limits:
      # Maximum header size in bytes (default: 16384 = 16KB)
      max_header_size: 16384

      # Maximum body size in bytes (default: 10485760 = 10MB)
      max_body_size: 10485760

      # Maximum URL length (default: 2048)
      max_url_length: 2048

    # Slow request protection (Slowloris defense)
    slow_request_protection:
      # Minimum bytes per second for headers (default: 1024)
      min_header_rate: 1024

      # Minimum bytes per second for body (default: 10240)
      min_body_rate: 10240

      # Timeout for slow requests in seconds (default: 30)
      timeout_seconds: 30

    # TLS handshake anomaly detection
    tls_anomaly_detection:
      # Maximum failed handshakes before blocking (default: 5)
      max_failed_handshakes: 5

      # Time window in seconds (default: 60)
      window_seconds: 60

# Domain configurations
domains:
  # Example domain with SSL enabled
  example.com:
    # Backend servers for load balancing
    backends:
      - http://localhost:3000
      - http://localhost:3001
      - http://localhost:3002

    # SSL/TLS configuration
    ssl:
      enabled: true
      cert_path: /path/to/example.com/cert.pem
      key_path: /path/to/example.com/key.pem

    # Load balancing strategy: round_robin, least_connections, or ip_hash
    load_balance_strategy: round_robin

    # Health check configuration
    health_check:
      enabled: true
      interval: 10  # seconds
      timeout: 5    # seconds
      path: /health # health check endpoint

  # Example domain without SSL
  api.example.com:
    backends:
      - http://10.0.1.10:8080
      - http://10.0.1.11:8080

    ssl:
      enabled: false

    load_balance_strategy: least_connections

    health_check:
      enabled: true
      interval: 5
      timeout: 3
      path: /api/health

  # Example with IP hash load balancing (sticky sessions)
  app.example.com:
    backends:
      - http://192.168.1.100:8000
      - http://192.168.1.101:8000
      - http://192.168.1.102:8000

    ssl:
      enabled: true
      cert_path: /path/to/app.example.com/cert.pem
      key_path: /path/to/app.example.com/key.pem

    load_balance_strategy: ip_hash

    health_check:
      enabled: true
      interval: 15
      timeout: 5
      path: /
